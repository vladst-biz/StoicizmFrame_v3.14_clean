# ARCHITECTURAL NODE PROTOCOL — STOICIZMFRAME
## Протокол создания, фиксации и эволюции архитектурных узлов

Версия: 3.4  
Назначение: обеспечить единый ритуал изменений в проекте StoicizmFrame.

---

## 1. Определение архитектурного узла
Архитектурный узел — это атомарное изменение в проекте, которое:
- влияет на структуру,
- влияет на архитектуру,
- влияет на фабрику контента,
- требует документирования,
- требует фиксации в истории.

Каждый узел должен быть:
- описан,
- выполнен,
- проверен,
- зафиксирован,
- защищён rollback‑меткой.

---

## 2. Структура архитектурного узла
Каждый узел включает:

1. **Описание**
   - что создаётся или изменяется
   - зачем это нужно
   - к какому уровню относится (heritage, infrastructure, factory, pipeline)

2. **Реализация**
   - код
   - структура
   - файлы
   - изменения

3. **Проверка**
   - кодировка UTF‑8 без BOM
   - переносы LF
   - корректность структуры
   - отсутствие побочных эффектов

4. **Фиксация**
   - git add
   - git commit с формулой:
     ```
     Architectural node: <название> established
     ```

5. **Rollback‑тег**
   - один тег на один узел
   - формат:
     ```
     ROLLBACK_XXX
     ```

6. **Документирование**
   - запись в HERITAGE.md
   - запись в dev_log.txt

---

## 3. Правила эволюции узлов
1. Узлы выполняются последовательно.
2. Узлы не пересекаются по смыслу.
3. Узлы не отменяют друг друга.
4. Узлы могут расширять предыдущие.
5. Узлы могут создавать новые уровни фабрики.
6. Узлы являются юридической основой проекта.

---

## 4. Запрещено
- изменять проект без узла,
- удалять узлы,
- изменять историю git,
- выполнять изменения без фиксации,
- нарушать кодировку и структуру.

---

## 5. Пример узла

# === STOICIZMFRAME — ATOM BLOCK 3 (FIXED) ===
# Создание ARCHITECTURAL_NODE_PROTOCOL.md

$projectRoot = "D:\StoicizmFrame_v3.14_clean"
$heritageDir = Join-Path $projectRoot "docs\heritage"
$nodeFile = Join-Path $heritageDir "ARCHITECTURAL_NODE_PROTOCOL.md"

if (-not (Test-Path $heritageDir)) {
    New-Item -ItemType Directory -Path $heritageDir -Force | Out-Null
}

# ВАЖНО:
# Используем двойные кавычки внутри here-string, чтобы исключить конфликт с Markdown
# ИСКЛЮЧАЕМ любые последовательности '@ или '@'

$content = @'
# ARCHITECTURAL NODE PROTOCOL — STOICIZMFRAME
## Протокол создания, фиксации и эволюции архитектурных узлов

Версия: 3.4
Назначение: обеспечить единый ритуал изменений в проекте StoicizmFrame.

---

## 1. Определение архитектурного узла
Архитектурный узел — это атомарное изменение в проекте, которое:
- влияет на структуру,
- влияет на архитектуру,
- влияет на фабрику контента,
- требует документирования,
- требует фиксации в истории.

Каждый узел должен быть:
- описан,
- выполнен,
- проверен,
- зафиксирован,
- защищён rollback-меткой.

---

## 2. Структура архитектурного узла
Каждый узел включает:

1. Описание
2. Реализация
3. Проверка
4. Фиксация
5. Rollback-тег
6. Документирование

---

## 3. Правила эволюции узлов
1. Узлы выполняются последовательно.
2. Узлы не пересекаются по смыслу.
3. Узлы не отменяют друг друга.
4. Узлы могут расширять предыдущие.
5. Узлы могут создавать новые уровни фабрики.
6. Узлы являются юридической основой проекта.

---

## 4. Запрещено
- изменять проект без узла,
- удалять узлы,
- изменять историю git,
- выполнять изменения без фиксации,
- нарушать кодировку и структуру.

---

## 5. Пример узла
Узел 3.4.2 — Architectural Map 3.4
Дата: (авто)
Файл: docs/heritage/ARCHITECTURAL_MAP_3_4.md
Причина: фиксация архитектурной карты
Последствия: разрешён переход к протоколу узлов

---

## 6. Завершение узла
Узел считается завершённым, когда:
- файл создан,
- кодировка проверена,
- git-фиксация выполнена,
- rollback-тег создан,
- HERITAGE.md обновлён,
- dev_log.txt обновлён.