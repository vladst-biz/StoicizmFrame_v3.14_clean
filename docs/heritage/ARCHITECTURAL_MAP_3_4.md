# ARCHITECTURAL MAP 3.4 — STOICIZMFRAME
## Концептуальная и техническая карта фабрики контента

Версия: 3.4  
Узел: 3.4.x — Архитектурное оформление и фабрика контента

---

## 1. Уровни архитектуры

### 1.1. Уровень наследия и законов
- HERITAGE.md — история архитектурных узлов
- WORKSPACE_PROTOCOL.md — режим работы с проектом
- ARCHITECTURAL_NODE_PROTOCOL.md — правила создания и фиксации узлов (будет оформлен отдельным документом)
- dev_log.txt — оперативный журнал изменений

Назначение: сохранение памяти проекта, контроль эволюции, дисциплина изменений.

---

### 1.2. Уровень инфраструктуры
- docs/heritage/INFRASTRUCTURE_PROTOCOL.md — инфраструктурный протокол
- Структура каталогов:
  - src/ — ядро и базовые модули
  - services/ — сервисные компоненты
  - scenarios/ — сценарные блоки
  - scenes/ — сценовые элементы
  - pipeline/ — обработка и генерация
  - adapters/ — интеграции
  - interface/ — взаимодействие
  - infrastructure/ — низкоуровневые механизмы

Назначение: обеспечить стабильную, предсказуемую основу для всех уровней фабрики.

---

### 1.3. Уровень фабрики контента
Фабрика строится вокруг полного цикла:

donors → scenario → voice → visual → render → publish

Основные компоненты:
- Donor Loader — загрузка и нормализация текстов-доноров
- Scenario Builder — конструирование сценариев и сцен
- Voice Adapter — генерация озвучки
- Visual/Layout Composer — формирование видеоряда
- Content Pipeline — сквозной процесс от текста до готового ролика

Назначение: превращать сырьевой текст в готовый медиапродукт.

---

### 1.4. Уровень интеграций и публикаций
- YouTube Publisher — загрузка видео и метаданных на канал
- Telegram Publisher — публикация контента в Telegram-канал
- Settings/Profiles — профили продукта (ниша, длительность, стили, частота публикаций)

Назначение: доставлять результат фабрики пользователям и обеспечивать монетизацию.

---

## 2. Техническая карта модулей

### 2.1. Donors (источники контента)
Расположение:
- src/donors/

Ключевые задачи:
- Загрузка текстов из файлов/папок/внешних источников
- Очистка и нормализация текста
- Подготовка «сырьевых блоков» для сценарного уровня

Пример базового модуля:
- src/donors/donor_loader.py

---

### 2.2. Scenario (сценарии и сцены)
Расположение:
- src/scenario/
- src/scenes/

Ключевые задачи:
- Преобразование донор-текста в сценарную структуру
- Разбиение на сцены:
  - ENTRY — вход, крючок
  - BODY — основное содержание
  - LEGACY — вывод, след, переход к следующему
- Подготовка текста для озвучки и визуала

Примеры модулей:
- src/scenario/scenario_builder.py
- src/scenes/scene_model.py

---

### 2.3. Voice (озвучка)
Расположение:
- src/voice/
- infrastructure/ (адаптеры к Azure или другим TTS)

Ключевые задачи:
- Преобразование сценарного текста в аудиодорожки
- Поддержка многоголосия и разных ролей
- Управление параметрами голоса (тон, скорость, стиль)

Примеры модулей:
- src/voice/voice_adapter.py
- infrastructure/azure_voice_service.py

---

### 2.4. Visual/Layout (визуальный ряд)
Расположение:
- src/video/
- src/layout/

Ключевые задачи:
- Формирование визуальных последовательностей под сцены
- Наложение субтитров, титров, вставок
- Сборка финального таймлайна под озвучку

Примеры модулей:
- src/video/layout_composer.py
- src/video/assets_loader.py

---

### 2.5. Pipeline (сквозной процесс)
Расположение:
- src/pipeline/

Ключевые задачи:
- Управление полным циклом:
  donors → scenario → voice → visual → render → publish
- Описание шагов пайплайна в явном виде
- Минимальное API:
  - generate_video_from_text(donor_text) → Path
  - generate_batch_from_folder(folder) → list[Path]

Примеры модулей:
- src/pipeline/content_pipeline.py

---

### 2.6. Publish (публикация)
Расположение:
- src/publish/

Ключевые задачи:
- Публикация видео на YouTube
- Публикация видео/постов в Telegram
- Логирование идентификаторов опубликованного контента

Примеры модулей:
- src/publish/youtube_publisher.py
- src/publish/telegram_publisher.py

---

## 3. Архитектурные принципы версии 3.4

### 3.1. Ясное разделение слоёв
- Наследие (heritage) отделено от кода
- Инфраструктура отделена от фабрики
- Фабрика отделена от интеграций

Принцип: каждый слой можно развивать и тестировать независимо.

---

### 3.2. Прозрачный pipeline
Все этапы обработки определены явно:
- donors
- scenario
- voice
- visual
- render
- publish

Принцип: на любом этапе можно:
- остановиться
- проверить
- заменить реализацию
- расширить без ломки архитектуры.

---

### 3.3. Управляемая эволюция
Любые изменения:
- проходят через архитектурный узел
- документируются в HERITAGE.md
- фиксируются в dev_log.txt
- защищаются rollback-тегами

Принцип: система может расти, не разрушая себя.

---

## 4. Переход к реализации фабрики

Версия 3.4 завершает этап:
- Формализация инфраструктуры
- Формализация архитектурной карты
- Подготовка к реализации минимальной фабрики контента

Следующий шаг после 3.4:
- Реализация минимального ядра:
  - donor_loader
  - scenario_builder
  - voice_adapter
  - layout_composer
  - content_pipeline

Цель: выйти на генерацию контента и публикацию в YouTube/Telegram с возможностью дальнейшей монетизации.

---