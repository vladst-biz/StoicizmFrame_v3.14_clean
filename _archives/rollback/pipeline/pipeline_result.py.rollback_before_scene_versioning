
# === Pipeline Status Constants ===
STATUS_OK = "OK"
STATUS_ERROR = "ERROR"
STATUS_PENDING = "PENDING"


class PipelineResult:
    """
    Расширенный результат пайплайна.
    Хранит:
    - статус выполнения
    - QC-сообщения
    - ошибки
    - метаданные
    """

    def __init__(self):
        self.status = STATUS_OK
        self.messages = []
        self.errors = []
        self.metadata = {}

    # === Методы статусов ===

    def mark_ok(self):
        self.status = STATUS_OK

    def mark_error(self, message=None):
        self.status = STATUS_ERROR
        if message:
            self.errors.append(message)

    def mark_pending(self, reason=None):
        """
        Помечает сцену как PENDING.
        Используется, когда QC фиксирует критические ошибки.
        """
        self.status = STATUS_PENDING
        if reason:
            self.errors.append(f"[PENDING] {reason}")


    # === Утилиты ===

    def add_message(self, msg):
        self.messages.append(msg)

    def add_metadata(self, key, value):
        self.metadata[key] = value

    def is_ok(self):
        return self.status == STATUS_OK

    def is_error(self):
        return self.status == STATUS_ERROR

    def is_pending(self):
        return self.status == STATUS_PENDING

    def __repr__(self):
        return (
            f"PipelineResult(status={self.status}, "
            f"messages={len(self.messages)}, "
            f"errors={len(self.errors)}, "
            f"metadata_keys={list(self.metadata.keys())})"
        )


